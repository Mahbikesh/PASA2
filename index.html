<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>PASA COFFEE — Order & Enquiry</title>
  <style>
    :root{
      --bg1:#2b1d14; --bg2:#5a3b2c; --card:#fff; --ink:#1f1f1f;
      --accent:#8b5e34; --accent-2:#d4a373; --muted:#6b7280;
      --ok:#0a7c2f; --err:#b00020; --ring:#c09a7a; --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--ink);
      background:linear-gradient(155deg,var(--bg1),var(--bg2));
      overflow-x:hidden;
    }
    /* Animated background layers */
    #bgCanvas{position:fixed; inset:0; z-index:-3; display:block}
    .grad-overlay{
      position:fixed; inset:0; z-index:-2; pointer-events:none;
      background:
        radial-gradient(1100px 520px at -10% -20%, rgba(255,255,255,0.06), transparent 60%),
        radial-gradient(900px 460px at 110% 0%, rgba(255,255,255,0.06), transparent 60%);
      mix-blend-mode:screen;
    }
    /* Animated watermark logo */
    .logo-watermark{
      position:fixed; left:50%; top:50%; translate:-50% -50%;
      width:min(70vw,520px); opacity:.10; z-index:-1; pointer-events:none;
      filter:drop-shadow(0 8px 20px rgba(0,0,0,.5));
      animation: floatY 12s ease-in-out infinite alternate, pulse 9s ease-in-out infinite;
    }
    @keyframes floatY{from{transform:rotate(-6deg)} to{transform:rotate(6deg)}}
    @keyframes pulse{0%,100%{scale:1} 50%{scale:1.03}}

    .wrap{max-width:980px; margin:0 auto; padding:24px 16px 80px}
    header{color:#fff; text-align:center; padding:30px 12px 20px}
    .brand{display:inline-block; padding:8px 14px; border:1px solid rgba(255,255,255,.25); border-radius:999px; letter-spacing:.18em; font-weight:700; text-transform:uppercase; background:rgba(255,255,255,.06); backdrop-filter:saturate(120%) blur(2px)}
    h1{margin:14px 0 8px; font-size:clamp(28px,6vw,40px); color:#fff}
    .sub{max-width:780px; margin:0 auto; color:#f2e9e4}

    .card{background:var(--card); border-radius:var(--radius); padding:18px; margin:14px 0; box-shadow:0 10px 24px rgba(0,0,0,.12); border:1px solid #eee}
    .grid{display:grid; gap:12px}
    @media(min-width:720px){ .grid-2{grid-template-columns:1fr 1fr} }
    fieldset{border:0; padding:0; margin:0}
    legend{font-weight:700; margin-bottom:8px; color:#2a211c}
    label{display:block; font-size:14px; color:#3b3b3b; margin-bottom:4px}
    input[type="text"], input[type="date"], input[type="email"], input[type="tel"], input[type="number"], textarea{
      width:100%; border:1px solid #dcd3cc; border-radius:10px; padding:10px 12px; font:inherit; outline:none; background:#fff;
    }
    input:focus, textarea:focus{border-color:var(--ring); box-shadow:0 0 0 3px rgba(192,154,122,.25)}
    .helper{font-size:12px; color:var(--muted); margin-top:4px}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .chip{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; border:1px solid #e7e2de; background:#faf8f6; cursor:pointer; user-select:none}
    .chip input{accent-color:var(--accent)}
    .radio-row{display:flex; gap:10px; flex-wrap:wrap}
    .actions{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .btn{appearance:none; border:0; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer; background:linear-gradient(180deg,var(--accent),var(--accent-2)); color:#1f130b; box-shadow:0 8px 18px rgba(139,94,52,.35)}
    .btn:active{transform:translateY(1px)}
    .notice{font-size:14px; color:var(--ok); display:none}
    .error{font-size:12px; color:var(--err); margin-top:4px; display:none}
    .inline{display:inline}
    .kg-inputs{display:grid; grid-template-columns:1fr 110px; gap:10px; align-items:end}
    .gadget-grid{display:grid; grid-template-columns:1fr 110px; gap:10px}
    .footer{margin-top:30px; text-align:center; color:#eaddcf; font-size:14px}
  </style>
</head>
<body>
  <!-- Animated background -->
  <canvas id="bgCanvas" aria-hidden="true"></canvas>
  <div class="grad-overlay" aria-hidden="true"></div>
  <!-- Animated watermark logo (embedded as data URI) -->
  <img class="logo-watermark" alt="" id="logo"/>

  <div class="wrap">
    <header>
      <span class="brand">PASA COFFEE</span>
      <h1>Order & Enquiry</h1>
      <p class="sub">
        We craft specialty coffee and share the why behind every cup—origin, processing, roast, and brew.
        Book hands-on barista training or place an order for beans, gadgets, or espresso machine rental.
      </p>
    </header>

    <main>
      <form id="orderForm" novalidate>
        <!-- Barista Training -->
        <section class="card" aria-labelledby="trainHead">
          <fieldset>
            <legend id="trainHead">Barista Training Selection</legend>
            <p class="helper">Choose one or more time slots, or pick the weekly batch. Optional start date.</p>

            <div class="row" role="group" aria-label="Training time slots">
              <label class="chip"><input type="checkbox" name="slot" value="12-day, 10–12 AM">10–12 AM</label>
              <label class="chip"><input type="checkbox" name="slot" value="12-day, 1–3 PM">1–3 PM</label>
              <label class="chip"><input type="checkbox" name="slot" value="12-day, 4–6 PM">4–6 PM</label>
              <label class="chip"><input type="checkbox" name="slot" value="12-day, 7–9 PM">7–9 PM</label>
              <label class="chip"><input type="checkbox" id="weeklyBatch" name="weekly" value="Weekly batch">Weekly batch</label>
            </div>

            <div class="grid grid-2" style="margin-top:10px">
              <div>
                <label for="startDate">Optional start date</label>
                <input type="date" id="startDate" name="startDate" />
              </div>
            </div>
          </fieldset>
        </section>

        <!-- Espresso Machine Rental -->
        <section class="card" aria-labelledby="machineHead">
          <fieldset>
            <legend id="machineHead">Espresso Machine Rental</legend>
            <div class="radio-row" role="radiogroup" aria-label="Machine type">
              <label class="chip"><input type="radio" name="machine" value="Single group head">Single group head</label>
              <label class="chip"><input type="radio" name="machine" value="Two group head">Two group head</label>
            </div>
            <div class="grid grid-2" style="margin-top:10px">
              <div>
                <label for="eventDate">Event date (optional)</label>
                <input type="date" id="eventDate" name="eventDate" />
              </div>
              <div>
                <label for="rentalNotes">Notes (optional)</label>
                <input type="text" id="rentalNotes" name="rentalNotes" placeholder="Venue, hours, extras…" />
              </div>
            </div>
          </fieldset>
        </section>

        <!-- Coffee Beans -->
        <section class="card" aria-labelledby="beansHead">
          <fieldset>
            <legend id="beansHead">Coffee Beans Order</legend>
            <div class="grid" style="gap:14px">
              <div class="kg-inputs">
                <div><label for="kgBrazil">Brazil (kg)</label></div>
                <div>
                  <input id="kgBrazil" name="kgBrazil" type="number" step="0.1" min="0" inputmode="decimal" placeholder="0.0">
                  <div class="error" id="errBrazil">Please enter a number ≥ 0.</div>
                </div>
              </div>
              <div class="kg-inputs">
                <div><label for="kgEthiopia">Ethiopia (kg)</label></div>
                <div>
                  <input id="kgEthiopia" name="kgEthiopia" type="number" step="0.1" min="0" inputmode="decimal" placeholder="0.0">
                  <div class="error" id="errEthiopia">Please enter a number ≥ 0.</div>
                </div>
              </div>
              <div class="kg-inputs">
                <div><label for="kgAtomic">Atomic Blend (kg)</label></div>
                <div>
                  <input id="kgAtomic" name="kgAtomic" type="number" step="0.1" min="0" inputmode="decimal" placeholder="0.0">
                  <div class="error" id="errAtomic">Please enter a number ≥ 0.</div>
                </div>
              </div>
            </div>
          </fieldset>
        </section>

        <!-- Coffee Gadgets: exactly 4 lines -->
        <section class="card" aria-labelledby="gadgetHead">
          <fieldset>
            <legend id="gadgetHead">Coffee Gadgets</legend>
            <p class="helper">Enter up to four gadgets. Only gadgets with a name and units &gt; 0 are included.</p>
            <div class="grid" style="gap:14px">
              <div class="gadget-grid">
                <div><label for="g1Name">Gadget 1 name</label><input id="g1Name" type="text" placeholder="e.g., V60 Dripper"/></div>
                <div><label for="g1Units">Units</label><input id="g1Units" type="number" min="0" step="1" inputmode="numeric" placeholder="0"/><div class="error" id="g1Err">Units must be ≥ 0.</div></div>
              </div>
              <div class="gadget-grid">
                <div><label for="g2Name">Gadget 2 name</label><input id="g2Name" type="text" placeholder="e.g., Kettle"/></div>
                <div><label for="g2Units">Units</label><input id="g2Units" type="number" min="0" step="1" inputmode="numeric" placeholder="0"/><div class="error" id="g2Err">Units must be ≥ 0.</div></div>
              </div>
              <div class="gadget-grid">
                <div><label for="g3Name">Gadget 3 name</label><input id="g3Name" type="text" placeholder="e.g., Scale"/></div>
                <div><label for="g3Units">Units</label><input id="g3Units" type="number" min="0" step="1" inputmode="numeric" placeholder="0"/><div class="error" id="g3Err">Units must be ≥ 0.</div></div>
              </div>
              <div class="gadget-grid">
                <div><label for="g4Name">Gadget 4 name</label><input id="g4Name" type="text" placeholder="e.g., Grinder"/></div>
                <div><label for="g4Units">Units</label><input id="g4Units" type="number" min="0" step="1" inputmode="numeric" placeholder="0"/><div class="error" id="g4Err">Units must be ≥ 0.</div></div>
              </div>
            </div>
          </fieldset>
        </section>

        <!-- Customer Details -->
        <section class="card" aria-labelledby="custHead">
          <fieldset>
            <legend id="custHead">Customer Details</legend>
            <div class="grid">
              <div>
                <label for="fullName">Full Name <span class="inline" aria-hidden="true" style="color:var(--err)">*</span></label>
                <input id="fullName" name="fullName" type="text" autocomplete="name" required />
                <div class="error" id="errName">Full Name is required.</div>
              </div>
              <div>
                <label for="address">Address <span class="inline" aria-hidden="true" style="color:var(--err)">*</span></label>
                <textarea id="address" name="address" rows="3" placeholder="Street, area, city" required></textarea>
                <div class="error" id="errAddress">Address is required.</div>
              </div>
              <div class="grid grid-2">
                <div>
                  <label for="phone">Phone (optional)</label>
                  <input id="phone" name="phone" type="tel" autocomplete="tel" placeholder="+971…" />
                </div>
                <div>
                  <label for="email">Email (optional)</label>
                  <input id="email" name="email" type="email" autocomplete="email" placeholder="you@example.com" />
                </div>
              </div>
            </div>
          </fieldset>
        </section>

        <!-- Submit -->
        <section class="card">
          <div class="actions">
            <button type="submit" class="btn" id="sendBtn">Send via WhatsApp</button>
            <span class="notice" id="redirectNote" role="status" aria-live="polite">You’re being redirected to WhatsApp…</span>
          </div>
          <p class="helper" style="margin-top:8px">We’ll open a WhatsApp chat to <strong>+971 56 219 2908</strong> with your details.</p>
        </section>
      </form>
    </main>

    <footer class="footer">© <span id="year"></span> PASA COFFEE</footer>
  </div>

  <script>
    // ======= Watermark logo (embedded data URI) =======
    (function attachLogo(){
      const data = "/logo.png";
      document.getElementById("logo").src = data;
      // Subtle variation: swap animation direction every 10s
      setInterval(()=>{
        const el = document.getElementById("logo");
        el.style.animationDirection = (el.style.animationDirection === "reverse") ? "normal" : "reverse";
        // small random rotate offset
        const deg = (Math.random()*8 - 4).toFixed(2);
        el.style.transform = `rotate(${deg}deg)`;
      }, 10000);
    })();

    // ======= Falling coffee beans background (Canvas) =======
    (function(){
      const canvas = document.getElementById("bgCanvas");
      const ctx = canvas.getContext("2d");
      let W=0, H=0, DPR=1;
      let beans = [];
      const MAX = 120; // number of beans
      const COLORS = ["#3b2a21","#4a3227","#5c3a2b","#6b4330","#7a4a34"];

      function resize(){
        DPR = Math.min(Math.max(window.devicePixelRatio || 1, 1), 2);
        W = canvas.width = Math.floor(innerWidth * DPR);
        H = canvas.height = Math.floor(innerHeight * DPR);
        canvas.style.width = innerWidth+"px";
        canvas.style.height = innerHeight+"px";
      }
      addEventListener("resize", resize, {passive:true});
      resize();

      function newBean(y=-20){
        const r = 6 + Math.random()*12;
        return {
          x: Math.random()*W, y: y * DPR,
          vx: (Math.random()*0.6 - 0.3) * DPR,
          vy: (1 + Math.random()*1.6) * DPR,
          r: r * DPR,
          rot: Math.random()*Math.PI*2,
          vr: (Math.random()*0.02 - 0.01),
          color: COLORS[(Math.random()*COLORS.length)|0],
          shine: Math.random()*.15 + .05
        };
      }
      function ensure(){
        while(beans.length < MAX) beans.push(newBean(-Math.random()*H));
      }
      function drawBean(b){
        ctx.save();
        ctx.translate(b.x, b.y);
        ctx.rotate(b.rot);
        // oval
        const w = b.r*1.6, h = b.r;
        ctx.fillStyle = b.color;
        ctx.beginPath();
        for(let i=0;i<2;i++){
          ctx.ellipse(0,0,w,h,0,0,Math.PI*2);
        }
        ctx.fill();
        // groove
        ctx.strokeStyle = "rgba(0,0,0,0.25)";
        ctx.lineWidth = Math.max(1, b.r*0.12);
        ctx.beginPath();
        ctx.moveTo(-w*0.6,0);
        ctx.quadraticCurveTo(0,-h*0.4,w*0.6,0);
        ctx.stroke();
        // highlight
        ctx.globalAlpha = b.shine;
        ctx.fillStyle = "#fff";
        ctx.beginPath();
        ctx.ellipse(-w*0.2, -h*0.2, w*0.25, h*0.25, 0, 0, Math.PI*2);
        ctx.fill();
        ctx.restore();
      }
      function step(){
        ctx.clearRect(0,0,W,H);
        ensure();
        for(const b of beans){
          b.x += b.vx + Math.sin((performance.now()+b.y)*0.0007)*0.2*DPR;
          b.y += b.vy;
          b.rot += b.vr;
          // slight wind change
          b.vx += (Math.random()-0.5)*0.02;
          if(b.y - b.r > H + 10) { // recycle to top
            b.x = Math.random()*W;
            b.y = -20 * DPR;
            b.vy = (1 + Math.random()*1.6) * DPR;
          }
          drawBean(b);
        }
        requestAnimationFrame(step);
      }
      step();
    })();

    // ======= Form logic =======
    (function(){
      const $ = (sel, root=document) => root.querySelector(sel);
      const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
      const form = $("#orderForm");
      const redirectNote = $("#redirectNote");
      $("#year").textContent = new Date().getFullYear();

      const toNumber = (v) => {
        const t = String(v ?? "").trim();
        if(t==="") return 0;
        const n = Number(t);
        return Number.isFinite(n) ? n : NaN;
      };
      const showErr = (sel, show) => { const n=$(sel); if(n) n.style.display = show ? "block":"none"; };

      const validate = () => {
        let ok = true;
        if(String($("#fullName").value).trim()===""){ showErr("#errName", true); ok=false; } else showErr("#errName", false);
        if(String($("#address").value).trim()===""){ showErr("#errAddress", true); ok=false; } else showErr("#errAddress", false);

        const kgB = toNumber($("#kgBrazil").value);
        const kgE = toNumber($("#kgEthiopia").value);
        const kgA = toNumber($("#kgAtomic").value);
        if(Number.isNaN(kgB) || kgB < 0){ showErr("#errBrazil", true); ok=false; } else showErr("#errBrazil", false);
        if(Number.isNaN(kgE) || kgE < 0){ showErr("#errEthiopia", true); ok=false; } else showErr("#errEthiopia", false);
        if(Number.isNaN(kgA) || kgA < 0){ showErr("#errAtomic", true); ok=false; } else showErr("#errAtomic", false);

        // Gadgets
        [["#g1Name","#g1Units","#g1Err"],["#g2Name","#g2Units","#g2Err"],["#g3Name","#g3Units","#g3Err"],["#g4Name","#g4Units","#g4Err"]]
        .forEach(([n,u,e])=>{
          const name = $(n).value.trim();
          const raw = $(u).value;
          const units = toNumber(raw);
          if((name !== "" || String(raw).trim()!=="") && (Number.isNaN(units) || units < 0)){ showErr(e, true); ok=false; } else showErr(e, false);
        });

        return { ok, kgB, kgE, kgA };
      };

      const collect = (nums) => {
        const slots = $$('input[name="slot"]:checked').map(c => c.value);
        const weekly = $('#weeklyBatch').checked;

        const gadgets = [
          {name:$("#g1Name").value.trim(), units:toNumber($("#g1Units").value)},
          {name:$("#g2Name").value.trim(), units:toNumber($("#g2Units").value)},
          {name:$("#g3Name").value.trim(), units:toNumber($("#g3Units").value)},
          {name:$("#g4Name").value.trim(), units:toNumber($("#g4Units").value)},
        ];

        const chosen = $$('input[name="machine"]').find(r => r.checked);

        return {
          header: "Website generated order",
          training: { selections:[...slots, ...(weekly?["Weekly batch"]:[])], startDate: String($("#startDate").value||"").trim() },
          rental: { machine: chosen ? chosen.value : "", eventDate: String($("#eventDate").value||"").trim(), notes: String($("#rentalNotes").value||"").trim() },
          beans: { Brazil: nums.kgB, Ethiopia: nums.kgE, "Atomic Blend": nums.kgA },
          gadgets,
          customer: { name:String($("#fullName").value||"").trim(), address:String($("#address").value||"").trim(), phone:String($("#phone").value||"").trim(), email:String($("#email").value||"").trim() },
          ts: new Date()
        };
      };

      const pretty = (obj) => {
        const lines = [];
        lines.push(obj.header,"");
        if(obj.training.selections.length || obj.training.startDate){
          lines.push("Barista Training:");
          if(obj.training.selections.length) lines.push(" - " + obj.training.selections.join(", "));
          if(obj.training.startDate) lines.push(" - Start date: " + obj.training.startDate);
          lines.push("");
        }
        if(obj.rental.machine || obj.rental.eventDate || obj.rental.notes){
          lines.push("Espresso Machine Rental:");
          if(obj.rental.machine) lines.push(" - " + obj.rental.machine);
          if(obj.rental.eventDate) lines.push(" - Event date: " + obj.rental.eventDate);
          if(obj.rental.notes) lines.push(" - Notes: " + obj.rental.notes);
          lines.push("");
        }
        const beanLines = Object.entries(obj.beans).filter(([,kg]) => Number(kg)>0).map(([n,kg])=>` - ${n}: ${kg} kg`);
        if(beanLines.length){ lines.push("Coffee Beans:", ...beanLines, ""); }
        const gadgetLines = obj.gadgets.filter(g=>g.name && Number(g.units)>0).map(g=>` - ${g.name} — ${g.units} unit(s)`);
        if(gadgetLines.length){ lines.push("Coffee Gadgets:", ...gadgetLines, ""); }

        lines.push("Customer Details:");
        lines.push(` - Name: ${obj.customer.name}`);
        lines.push(` - Address: ${obj.customer.address}`);
        if(obj.customer.phone) lines.push(` - Phone: ${obj.customer.phone}`);
        if(obj.customer.email) lines.push(` - Email: ${obj.customer.email}`);
        lines.push("");

        const stamp = obj.ts.toLocaleString(undefined,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"});
        lines.push(`Timestamp: ${stamp}`);
        return lines.join("\n");
      };

      const sendWhatsApp = (text) => {
        const url = "https://wa.me/971562192908?text=" + encodeURIComponent(text);
        $("#redirectNote").style.display = "inline";
        window.location.href = url;
      };

      // Clear inline errors on input
      form.addEventListener("input",(e)=>{
        const id = e.target && e.target.id;
        if(id==="fullName") showErr("#errName", false);
        if(id==="address") showErr("#errAddress", false);
        if(id==="kgBrazil") showErr("#errBrazil", false);
        if(id==="kgEthiopia") showErr("#errEthiopia", false);
        if(id==="kgAtomic") showErr("#errAtomic", false);
        ["g1","g2","g3","g4"].forEach(k=>{ if(id===k+"Units") showErr("#"+k+"Err", false); });
      });

      form.addEventListener("submit",(e)=>{
        e.preventDefault();
        const v = validate();
        if(!v.ok) return;
        const data = collect(v);
        const message = pretty(data);
        sendWhatsApp(message);
      });
    })();

    // Footer year
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>
</body>
</html>
